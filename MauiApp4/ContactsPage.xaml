<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp4.ContactsPage"
             xmlns:vm="clr-namespace:MauiApp4.ViewModel"
             Title="ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹">

    <ContentPage.BindingContext>
        <vm:ContactsViewModel />
    </ContentPage.BindingContext>

    <Grid>
        <RefreshView IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshContactsCommand}">
            
            <ScrollView>
                <VerticalStackLayout Spacing="15" Padding="20">
                    
                    <Label Text="Ð¡ÐŸÐ˜Ð¡ÐžÐš ÐšÐžÐÐ¢ÐÐšÐ¢ÐžÐ’" 
                           HorizontalOptions="Center"
                           FontSize="24"
                           FontAttributes="Bold"/>
                    
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Entry Grid.Column="0" 
                               Placeholder="ÐŸÐ¾Ð¸ÑÐº..."
                               Text="{Binding SearchText}"
                               ReturnCommand="{Binding SearchContactCommand}"/>
                        <Button Grid.Column="1" 
                                Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ"
                                Command="{Binding AddContactCommand}"/>
                    </Grid>
                    
                    <CollectionView ItemsSource="{Binding Contacts}"
                                    SelectionMode="None">
                        
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Margin="0,5" Padding="10">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" 
                                          ColumnSpacing="10">
                                        
                                        <Image Grid.Column="0" 
                                               Source="user.png"
                                               WidthRequest="40"
                                               HeightRequest="40"
                                               VerticalOptions="Center"/>
                                        
                                        <VerticalStackLayout Grid.Column="1" 
                                                             VerticalOptions="Center">
                                            <Label Text="{Binding FullName}" 
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="Black"/>
                                            <Label Text="{Binding Phone}" 
                                                   FontSize="14"
                                                   TextColor="Black"/>
                                            <Label Text="{Binding Email}" 
                                                   FontSize="14"
                                                   TextColor="Black"/>
                                            <Label Text="{Binding Address}" 
                                                   FontSize="12"
                                                   TextColor="Black"/>
                                        </VerticalStackLayout>
                                        
                                        <Button Grid.Column="2"
                                                Text="âœï¸"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ContactsViewModel}}, Path=EditContactCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Transparent"/>
                                        
                                        <Button Grid.Column="3"
                                                Text="ðŸ—‘ï¸"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ContactsViewModel}}, Path=DeleteContactCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Transparent"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        
                        <CollectionView.EmptyView>
                            <VerticalStackLayout HorizontalOptions="Center" 
                                                 VerticalOptions="Center"
                                                 Padding="20">
                                <Label Text="ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
                                       FontSize="18"
                                       HorizontalOptions="Center"/>
                                <Label Text="ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ' Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°"
                                       FontSize="14"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                        
                    </CollectionView>
                    
                </VerticalStackLayout>
            </ScrollView>
            
        </RefreshView>
        
        <ActivityIndicator IsVisible="{Binding IsBusy}"
                           IsRunning="{Binding IsBusy}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           WidthRequest="50"
                           HeightRequest="50"/>
        
        <Border IsVisible="{Binding IsModalVisible}"
                BackgroundColor="#80000000"
                HorizontalOptions="Fill"
                VerticalOptions="Fill">
            
            <Frame Margin="20" 
                   Padding="20"
                   CornerRadius="10"
                   BackgroundColor="White">
                
                <VerticalStackLayout Spacing="15">
                    
                    <Label Text="{Binding EditingContact.Id, StringFormat='{}{0:Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚;ÐÐ¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚}'}"
                           FontSize="20"
                           HorizontalOptions="Center"
                           FontAttributes="Bold"/>
                    
                    <Entry Placeholder="Ð˜Ð¼Ñ*" 
                           Text="{Binding EditingContact.FirstName}"/>
                    
                    <Entry Placeholder="Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ*" 
                           Text="{Binding EditingContact.LastName}"/>
                    
                    <Entry Placeholder="Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½*" 
                           Text="{Binding EditingContact.Phone}" 
                           Keyboard="Telephone"/>
                    
                    <Entry Placeholder="Email*" 
                           Text="{Binding EditingContact.Email}" 
                           Keyboard="Email"/>
                    
                    <Entry Placeholder="ÐÐ´Ñ€ÐµÑ" 
                           Text="{Binding EditingContact.Address}"/>
                    
                    <Label Text="* - Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ"
                           FontSize="12"
                           TextColor="Gray"/>
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0" 
                                Text="ÐžÑ‚Ð¼ÐµÐ½Ð°" 
                                Command="{Binding CloseModalCommand}"/>
                        
                        <Button Grid.Column="1" 
                                Text="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ" 
                                Command="{Binding SaveContactCommand}"/>
                    </Grid>
                    
                </VerticalStackLayout>
                
            </Frame>
            
        </Border>
        
    </Grid>
    
</ContentPage>